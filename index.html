<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Supply Chain Visualization</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
    <style>
      #map {
        height: 600px;
      }
      .scatterplot {
        width: 200px;
        height: 200px;
      }
      .dot {
        fill: steelblue;
      }
      .tooltip {
        position: absolute;
        display: none;
        padding: 10px;
        background-color: white;
        border: 1px solid #ccc;
        border-radius: 5px;
      }
    </style>
  </head>
  <body>
    <div id="map"></div>
    <svg id="scatterplot"></svg>

    <div id="tooltip" class="tooltip"></div>

    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <script type="text/javascript" src="europe.js"></script>
    <script>
      // Initialize map
      var map = L.map('map').setView([51.505, -0.09], 4)
      map.createPane('labels')
      map.getPane('labels').style.zIndex = 650
      map.getPane('labels').style.pointerEvents = 'none'

      var geoJson

      // Add tile layer
      L.tileLayer(
        'https://{s}.basemaps.cartocdn.com/light_nolabels/{z}/{x}/{y}.png',
        {
          attribution: '©OpenStreetMap, ©CartoDB'
        }
      ).addTo(map)

      var positronLabels = L.tileLayer(
        'https://{s}.basemaps.cartocdn.com/light_only_labels/{z}/{x}/{y}.png',
        {
          attribution: '©OpenStreetMap, ©CartoDB',
          pane: 'labels'
        }
      ).addTo(map)

      // Add GeoJson
      geoJson = L.geoJson(euData, {
        style: style,
        onEachFeature: onEachFeature
      }).addTo(map)

      // Function for color
      function style(features) {
        return {
          fillColor: getColor(features.properties.NAME),
          weight: 1,
          opacity: 1,
          color: 'white',
          dashArray: '1',
          fillOpacity: 0.5
        }
      }

      // Sum of all map functions
      function onEachFeature(features, layer) {
        layer.on({
          mouseover: highlightFeature,
          mouseout: resetHighlight,
          click: zoomToFeature
        })
        layer.bindPopup(features.properties.NAME)
      }
      
      // Function for hover
      function highlightFeature(e) {
        var layer = e.target

        layer.setStyle({
          weight: 1,
          color: '#666',
          dashArray: '',
          fillOpacity: 0.7
        })

        layer.bringToFront()
      }

      // Function for unhover
      function resetHighlight(e) {
        geoJson.resetStyle(e.target)
      }

      // Zooms in to country
      function zoomToFeature(e) {
        map.fitBounds(e.target.getBounds())
      }

      // Sample distribution centers data (replace with actual data)
      var distributionCenters = [
        {
          id: 1,
          name: 'Distribution Center 1',
          lat: 48.8566,
          lng: 2.3522,
          data: [
            { quantity: 100, timeDifference: 10, label: 'DC1 Point 1' },
            { quantity: 200, timeDifference: 20, label: 'DC1 Point 2' },
            { quantity: 300, timeDifference: 15, label: 'DC1 Point 3' }
            // Add more data points here for Distribution Center 1
          ]
        },
        {
          id: 2,
          name: 'Distribution Center 2',
          lat: 51.5074,
          lng: -0.1278,
          data: [
            { quantity: 150, timeDifference: 12, label: 'DC2 Point 1' },
            { quantity: 250, timeDifference: 18, label: 'DC2 Point 2' },
            { quantity: 350, timeDifference: 25, label: 'DC2 Point 3' }
            // Add more data points here for Distribution Center 2
          ]
        }
        // Add more distribution centers here
      ]

      // Add distribution centers as markers
      distributionCenters.forEach(function (center) {
        var marker = L.marker([center.lat, center.lng]).addTo(map)
        marker.bindPopup(center.name)
        marker.on('click', function () {
          updateScatterplot(center.data)
        })
      })

      // Sample scatterplot data (default)
      var defaultScatterplotData = [
        { quantity: 100, timeDifference: 10, label: 'Point 1' },
        { quantity: 200, timeDifference: 20, label: 'Point 2' },
        { quantity: 300, timeDifference: 15, label: 'Point 3' }
        // Add more default data points here
      ]

      // Set up SVG dimensions
      var margin = { top: 20, right: 20, bottom: 30, left: 40 }
      var width = 600 - margin.left - margin.right
      var height = 400 - margin.top - margin.bottom

      // Create SVG element
      var svg = d3
        .select('#scatterplot')
        .attr('width', width + margin.left + margin.right)
        .attr('height', height + margin.top + margin.bottom)
        .append('g')
        .attr('transform', 'translate(' + margin.left + ',' + margin.top + ')')

      // Create scales
      var xScale = d3
        .scaleLinear()
        .domain([
          0,
          d3.max(defaultScatterplotData, function (d) {
            return d.quantity
          })
        ])
        .range([0, width])

      var yScale = d3
        .scaleLinear()
        .domain([
          0,
          d3.max(defaultScatterplotData, function (d) {
            return d.timeDifference
          })
        ])
        .range([height, 0])

      // Add dots for default data points
      svg
        .selectAll('.dot')
        .data(defaultScatterplotData)
        .enter()
        .append('circle')
        .attr('class', 'dot')
        .attr('cx', function (d) {
          return xScale(d.quantity)
        })
        .attr('cy', function (d) {
          return yScale(d.timeDifference)
        })
        .attr('r', 5)

      // Add axes
      var xAxis = d3.axisBottom(xScale)
      var yAxis = d3.axisLeft(yScale)

      svg
        .append('g')
        .attr('class', 'x axis')
        .attr('transform', 'translate(0,' + height + ')')
        .call(xAxis)

      svg.append('g').attr('class', 'y axis').call(yAxis)

      // Function to update scatterplot data
      function updateScatterplot(data) {
        // Remove existing dots
        svg.selectAll('.dot').remove()

        // Update scales
        xScale.domain([
          0,
          d3.max(data, function (d) {
            return d.quantity
          })
        ])
        yScale.domain([
          0,
          d3.max(data, function (d) {
            return d.timeDifference
          })
        ])

        // Add new dots for updated data
        svg
          .selectAll('.dot')
          .data(data)
          .enter()
          .append('circle')
          .attr('class', 'dot')
          .attr('cx', function (d) {
            return xScale(d.quantity)
          })
          .attr('cy', function (d) {
            return yScale(d.timeDifference)
          })
          .attr('r', 5)

        // Update axes
        svg.select('.x.axis').call(xAxis)
        svg.select('.y.axis').call(yAxis)
      }

      // Color picker function for the map
      function getColor(d) {
        return d === 'Croatia' ||
          d === 'France' ||
          d === 'Italy' ||
          d === 'Portugal' ||
          d === 'Slovenia' ||
          d === 'Spain' ||
          d === 'Switzerland'
          ? '#99d594'
          : d === 'Germany' || d === 'Belgium' || d === 'Netherlands'
          ? '#fc8d59'
          : d === 'Czech Republic' ||
            d === 'Greece' ||
            d === 'Hungary' ||
            d === 'Poland'
          ? '#beaed4'
          : d === 'United Kingdom'
          ? '#fbb4ae'
          : d === 'Denmark' ||
            d === 'Sweden' ||
            d === 'Estonia' ||
            d === 'Finland' ||
            d === 'Latvia' ||
            d === 'Lithuania' ||
            d === 'Norway'
          ? '#91bfdb'
          : '#bdbdbd'
      }
    </script>
  </body>
</html>
