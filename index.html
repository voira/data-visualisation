<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Supply Chain Visualization</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
    <style>
      #map {
        height: 600px;
      }
      .scatterplot {
        width: 200px;
        height: 200px;
      }
      .dot {
        fill: steelblue;
      }
      .tooltip {
        position: absolute;
        display: none;
        padding: 10px;
        background-color: white;
        border: 1px solid #ccc;
        border-radius: 5px;
      }
    </style>
  </head>
  <body>
    <div id="map"></div>
    <svg id="scatterplot"></svg>

    <div id="tooltip" class="tooltip"></div>

    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <script type="text/javascript" src="europe.js"></script>
    <script>
      // Initialize map
      var map = L.map('map').setView([51.505, -0.09], 4)
      var geoJson

      // Add tile layer
      L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        attribution: '&copy; OpenStreetMap contributors'
      }).addTo(map)

      // Add GeoJson
      geoJson = L.geoJson(euData, {
        style: style,
        onEachFeature: onEachFeature
      }).addTo(map)

      // Function for color
      function style(features) {
        return {
          fillColor: getColor(features.properties.NAME),
          weight: 1,
          opacity: 1,
          color: 'white',
          dashArray: '1',
          fillOpacity: 0.5
        }
      }

      // Sum of all map functions
      function onEachFeature(features, layer) {
        layer.on({
          mouseover: highlightFeature,
          mouseout: resetHighlight,
          click: zoomToFeature
        })
      }
      // Function for hover
      function highlightFeature(e) {
        var layer = e.target

        layer.setStyle({
          weight: 1,
          color: '#666',
          dashArray: '',
          fillOpacity: 0.7
        })

        layer.bringToFront()
      }

      // Function for unhover
      function resetHighlight(e) {
        geoJson.resetStyle(e.target)
      }

      // Zooms in to country
      function zoomToFeature(e) {
        map.fitBounds(e.target.getBounds())
      }

      //Create overlay thingy
      var Paris =L.marker([48.8566, 2.3522]).bindPopup('This is Paris')
          London =L.marker([51.5074, -0.1278]).bindPopup('This is London')
          AntwerpenP=L.marker([51.29999, 4.30758]).bindPopup('Antwerpen Production')
          WroclavP=L.marker([51.11862, 16.99842]).bindPopup('Wrocłav Productions')
          LyonP=L.marker([45.75555, 4.76737]).bindPopup('Lyon Productions')
          AntwerpenDC=L.marker([51.2999, 4.30758]).bindPopup('Antwerpen Distribution Center')
          WroclavDC=L.marker([51.11862, 16.99842]).bindPopup('Wrocłav Distribution Center')
          LyonDC=L.marker([45.75555, 4.76737]).bindPopup('Lyon Distribution Center')
          BirminghamDC=L.marker([52.42853, -1.89877]).bindPopup('Birmingham Distribution Center')
          GoteborgDC=L.marker([57.72338, 11.85666]).bindPopup('Göteborg Distribution Center')


      var Plants =L.layerGroup([AntwerpenP, WroclavP, LyonP])
          DistC =L.layerGroup([AntwerpenDC, WroclavDC, LyonDC, BirminghamDC, GoteborgDC])
      var overlayMaps = {
        "Distribution Centers": DistC,
        "Production Plants": Plants
      };

      var layerControl = L.control.layers(0, overlayMaps).addTo(map);

      // Sample scatterplot data (default)
      var defaultScatterplotData = [
        { quantity: 100, timeDifference: 10, label: 'Point 1' },
        { quantity: 200, timeDifference: 20, label: 'Point 2' },
        { quantity: 300, timeDifference: 15, label: 'Point 3' }
        // Add more default data points here
      ]

      // Set up SVG dimensions
      var margin = { top: 20, right: 20, bottom: 30, left: 40 }
      var width = 600 - margin.left - margin.right
      var height = 400 - margin.top - margin.bottom

      // Create SVG element
      var svg = d3
        .select('#scatterplot')
        .attr('width', width + margin.left + margin.right)
        .attr('height', height + margin.top + margin.bottom)
        .append('g')
        .attr('transform', 'translate(' + margin.left + ',' + margin.top + ')')

      // Create scales
      var xScale = d3
        .scaleLinear()
        .domain([
          0,
          d3.max(defaultScatterplotData, function (d) {
            return d.quantity
          })
        ])
        .range([0, width])

      var yScale = d3
        .scaleLinear()
        .domain([
          0,
          d3.max(defaultScatterplotData, function (d) {
            return d.timeDifference
          })
        ])
        .range([height, 0])

      // Add dots for default data points
      svg
        .selectAll('.dot')
        .data(defaultScatterplotData)
        .enter()
        .append('circle')
        .attr('class', 'dot')
        .attr('cx', function (d) {
          return xScale(d.quantity)
        })
        .attr('cy', function (d) {
          return yScale(d.timeDifference)
        })
        .attr('r', 5)

      // Add axes
      var xAxis = d3.axisBottom(xScale)
      var yAxis = d3.axisLeft(yScale)

      svg
        .append('g')
        .attr('class', 'x axis')
        .attr('transform', 'translate(0,' + height + ')')
        .call(xAxis)

      svg.append('g').attr('class', 'y axis').call(yAxis)

      // Function to update scatterplot data
      function updateScatterplot(data) {
        // Remove existing dots
        svg.selectAll('.dot').remove()

        // Update scales
        xScale.domain([
          0,
          d3.max(data, function (d) {
            return d.quantity
          })
        ])
        yScale.domain([
          0,
          d3.max(data, function (d) {
            return d.timeDifference
          })
        ])

        // Add new dots for updated data
        svg
          .selectAll('.dot')
          .data(data)
          .enter()
          .append('circle')
          .attr('class', 'dot')
          .attr('cx', function (d) {
            return xScale(d.quantity)
          })
          .attr('cy', function (d) {
            return yScale(d.timeDifference)
          })
          .attr('r', 5)

        // Update axes
        svg.select('.x.axis').call(xAxis)
        svg.select('.y.axis').call(yAxis)
      }

      // Color picker function for the map
      function getColor(d) {
        return d === 'Croatia' ||
          d === 'France' ||
          d === 'Italy' ||
          d === 'Portugal' ||
          d === 'Slovenia' ||
          d === 'Spain' ||
          d === 'Switzerland'
          ? '#99d594'
          : d === 'Germany' || d === 'Belgium' || d === 'Netherlands'
          ? '#fc8d59'
          : d === 'Czech Republic' ||
            d === 'Greece' ||
            d === 'Hungary' ||
            d === 'Poland'
          ? '#beaed4'
          : d === 'United Kingdom'
          ? '#fbb4ae'
          : d === 'Denmark' ||
            d === 'Sweden' ||
            d === 'Estonia' ||
            d === 'Finland' ||
            d === 'Latvia' ||
            d === 'Lithuania' ||
            d === 'Norway'
          ? '#91bfdb'
          : '#bdbdbd'
      }
    </script>
  </body>
</html>
